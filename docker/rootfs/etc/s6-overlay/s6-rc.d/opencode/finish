#!/bin/bash
# Finish script for OpenCode service

EXIT_CODE=$1
echo "[opencode] Service stopped with exit code ${EXIT_CODE}"

# Exit codes:
# 0   = Normal exit
# 143 = SIGTERM (graceful shutdown)
# 130 = SIGINT (Ctrl+C)
# 137 = SIGKILL (force kill)

if [ "${EXIT_CODE}" -eq 0 ] || [ "${EXIT_CODE}" -eq 143 ] || [ "${EXIT_CODE}" -eq 130 ] || [ "${EXIT_CODE}" -eq 137 ]; then
    exit 0
fi

# Abnormal exit - wait before s6 restarts
echo "[opencode] Abnormal exit, restarting in 5 seconds..."
sleep 5
